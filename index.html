<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Trading Journal</title>
    <style>
        /* --- THEME VARIABLES --- */
        :root {
            /* Light Theme (Default) */
            --bg-color: #f4f6f8;
            --card-bg: #ffffff;
            --primary: #2563eb;
            --text: #1e293b;
            --text-secondary: #64748b;
            --green: #10b981;
            --red: #ef4444;
            --orange: #f59e0b;
            --border: #e2e8f0;
            --overlay: rgba(0, 0, 0, 0.5);
            --header-row: #f1f5f9;
            --cal-hover: #f8fafc;
            --input-bg: #ffffff;
        }

        [data-theme="dark"] {
            /* Dark Theme */
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --primary: #3b82f6;
            --text: #f1f5f9;
            --text-secondary: #94a3b8;
            --green: #34d399;
            --red: #f87171;
            --orange: #fbbf24;
            --border: #334155;
            --overlay: rgba(0, 0, 0, 0.7);
            --header-row: #334155;
            --cal-hover: #334155;
            --input-bg: #0f172a;
        }

        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg-color); color: var(--text); margin: 0; padding: 20px; transition: background-color 0.3s, color 0.3s; }
        .container { max-width: 1000px; margin: 0 auto; position: relative; }

        /* --- THEME TOGGLE BTN --- */
        .theme-toggle-btn {
            position: absolute; top: 0; right: 0;
            background: var(--card-bg); border: 1px solid var(--border);
            color: var(--text); padding: 8px 12px; border-radius: 20px;
            cursor: pointer; font-size: 1.2rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 100; transition: all 0.3s;
        }
        .theme-toggle-btn:hover { transform: scale(1.1); }

        /* --- NAVIGATION --- */
        .nav-container { display: flex; justify-content: center; margin-bottom: 25px; margin-top: 10px; }
        .nav-tabs { background: var(--card-bg); padding: 5px; border-radius: 30px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: inline-flex; border: 1px solid var(--border); }
        .nav-btn { border: none; background: none; padding: 10px 25px; border-radius: 25px; cursor: pointer; font-weight: 600; color: var(--text-secondary); transition: all 0.2s; }
        .nav-btn.active { background-color: var(--primary); color: white; }
        .nav-btn:hover:not(.active) { background-color: var(--border); }

        /* --- HEADER & STATS --- */
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        h1 { margin: 0; font-size: 1.5rem; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-card { background: var(--card-bg); padding: 20px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border: 1px solid var(--border); }
        .stat-card h3 { margin: 0 0 5px 0; font-size: 0.9rem; color: var(--text-secondary); }
        .stat-card p { margin: 0; font-size: 1.5rem; font-weight: bold; }

        /* --- FORM --- */
        .input-section { background: var(--card-bg); padding: 20px; border-radius: 8px; margin-bottom: 25px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border: 1px solid var(--border); }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; align-items: start; }
        .form-group { display: flex; flex-direction: column; }
        .full-width { grid-column: 1 / -1; }
        label { margin-bottom: 5px; font-size: 0.85rem; font-weight: 500; color: var(--text-secondary); }
        input, select, textarea { 
            padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px; 
            font-size: 0.95rem; font-family: inherit; 
            background-color: var(--input-bg); color: var(--text);
        }
        textarea { resize: vertical; }
        .btn-group { display: flex; gap: 10px; justify-content: flex-end; }
        button.add-btn { background-color: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; height: 40px; }
        button.cancel-btn { background-color: var(--text-secondary); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; height: 40px; display: none; }
        
        /* --- CONTROLS --- */
        .controls { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .outline-btn { background: transparent; border: 1px solid var(--primary); color: var(--primary); padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 0.85rem; }
        #fileInput { display: none; }
        
        /* --- TABLE --- */
        .table-container { background: var(--card-bg); border-radius: 8px; overflow-x: auto; box-shadow: 0 1px 3px rgba(0,0,0,0.1); min-height: 200px; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; min-width: 900px; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid var(--border); vertical-align: top; }
        th { background-color: var(--header-row); font-weight: 600; color: var(--text); }
        .profit { color: var(--green); font-weight: bold; }
        .loss { color: var(--red); font-weight: bold; }
        .action-cell { display: flex; gap: 8px; }
        .icon-btn { background: none; border: none; cursor: pointer; font-size: 1rem; padding: 4px; border-radius: 4px; filter: grayscale(100%); transition: filter 0.2s; }
        .icon-btn:hover { filter: none; background-color: var(--header-row); }
        
        /* Date Headers */
        .date-header { background-color: var(--header-row); }
        .date-header td { padding: 10px 15px; border-bottom: 1px solid var(--border); }
        .date-title { font-weight: 600; color: var(--text-secondary); display: flex; align-items: center; gap: 8px; }
        .daily-summary { float: right; font-weight: bold; font-size: 0.95rem; }

        /* --- CALENDAR --- */
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: var(--card-bg); padding: 15px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border: 1px solid var(--border); }
        .calendar-header h2 { margin: 0; font-size: 1.2rem; color: var(--text); }
        .month-btn { background: transparent; border: 1px solid var(--border); padding: 5px 15px; border-radius: 4px; cursor: pointer; font-weight: bold; color: var(--text); }
        .month-btn:hover { background: var(--cal-hover); }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; }
        .day-name { text-align: center; font-weight: 600; color: var(--text-secondary); padding-bottom: 10px; font-size: 0.9rem; }
        .calendar-cell { 
            background: var(--card-bg); border-radius: 8px; border: 1px solid var(--border); 
            min-height: 80px; padding: 8px; position: relative; display: flex; flex-direction: column; 
            justify-content: space-between; transition: transform 0.1s; 
        }
        .calendar-cell:hover { border-color: var(--primary); transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .date-num { font-weight: 600; font-size: 0.9rem; color: var(--text-secondary); }
        .cal-pnl { font-weight: 700; font-size: 0.95rem; text-align: right; }
        .cal-pnl.profit { color: var(--green); }
        .cal-pnl.loss { color: var(--red); }
        .empty-cell { background: transparent; border: none; }
        .today-cell { border: 2px solid var(--primary); }

        /* --- GUIDE & MODAL --- */
        .guide-box { background: var(--card-bg); padding: 30px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); max-width: 800px; margin: 0 auto; border: 1px solid var(--border); }
        .guide-step { margin-bottom: 25px; padding-bottom: 25px; border-bottom: 1px solid var(--border); }
        .guide-highlight { background: var(--header-row); border-left: 4px solid var(--primary); padding: 15px; margin-top: 10px; border-radius: 0 4px 4px 0; }
        .warning-box { background: rgba(239, 68, 68, 0.1); border: 1px solid var(--red); color: var(--red); padding: 15px; border-radius: 8px; margin-top: 20px; font-weight: 500; }

        #notification { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 8px; padding: 16px; position: fixed; z-index: 1000; right: 20px; top: 20px; transform: translateY(-20px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); font-weight: 500; opacity: 0; transition: opacity 0.3s, transform 0.3s; }
        #notification.show { visibility: visible; opacity: 1; transform: translateY(0); }
        #notification.success { background-color: var(--green); }
        #notification.error { background-color: var(--red); }
        
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--overlay); z-index: 2000; align-items: center; justify-content: center; backdrop-filter: blur(2px); }
        .modal-overlay.open { display: flex; }
        .modal-box { background: var(--card-bg); padding: 25px; border-radius: 12px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.2); animation: popIn 0.2s ease-out; border: 1px solid var(--border); }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-actions { display: flex; gap: 10px; justify-content: center; margin-top: 20px; }
        .btn-modal { padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-weight: 600; }
        .btn-cancel { background: var(--border); color: var(--text); }
        .btn-confirm { background: var(--red); color: white; }
    </style>
</head>
<body>

<div id="notification"></div>
<div id="confirmModal" class="modal-overlay">
    <div class="modal-box">
        <h3 id="modalTitle">Are you sure?</h3>
        <p id="modalMessage">Action cannot be undone.</p>
        <div class="modal-actions">
            <button class="btn-modal btn-cancel" onclick="closeModal()">Cancel</button>
            <button class="btn-modal btn-confirm" id="confirmActionBtn">Confirm</button>
        </div>
    </div>
</div>

<div class="container">
    <button class="theme-toggle-btn" id="themeToggle" title="Toggle Dark Mode">üåô</button>

    <div class="nav-container">
        <div class="nav-tabs">
            <button class="nav-btn active" onclick="switchTab('journal', this)">üìä Journal</button>
            <button class="nav-btn" onclick="switchTab('calendar', this)">üìÖ Calendar</button>
            <button class="nav-btn" onclick="switchTab('guide', this)">‚ùì How to Use</button>
        </div>
    </div>

    <div id="tab-journal">
        <header>
            <h1>My Trading Journal</h1>
            <div class="controls">
                <button class="outline-btn" onclick="downloadJSON()">üíæ Save</button>
                <button class="outline-btn" onclick="document.getElementById('fileInput').click()">üìÇ Load</button>
                <button class="outline-btn" style="border-color: var(--red); color: var(--red);" onclick="triggerClear()">üóëÔ∏è Reset</button>
                <input type="file" id="fileInput" accept=".json" onchange="loadJSON(this)">
            </div>
        </header>

        <div class="stats-grid">
            <div class="stat-card"><h3>Net P&L</h3><p id="totalPnL">‚Çπ0.00</p></div>
            <div class="stat-card"><h3>Win Rate</h3><p id="winRate">0%</p></div>
            <div class="stat-card"><h3>Total Trades</h3><p id="totalTrades">0</p></div>
        </div>

        <div class="input-section">
            <form id="tradeForm" onsubmit="handleFormSubmit(event)">
                <div class="form-grid">
                    <div class="form-group"><label>Date</label><input type="date" id="date" required></div>
                    <div class="form-group"><label>Symbol</label><input type="text" id="symbol" placeholder="e.g. RELIANCE" required></div>
                    <div class="form-group"><label>Type</label><select id="type"><option value="LONG">Long (Buy)</option><option value="SHORT">Short (Sell)</option></select></div>
                    <div class="form-group"><label>Entry Price</label><input type="number" step="0.05" id="entry" required></div>
                    <div class="form-group"><label>Exit Price</label><input type="number" step="0.05" id="exit" required></div>
                    <div class="form-group"><label>Quantity</label><input type="number" id="qty" required></div>
                    <div class="form-group full-width"><label>Notes</label><textarea id="notes" rows="2"></textarea></div>
                    <div class="form-group full-width btn-group">
                        <button type="button" class="cancel-btn" id="cancelEditBtn" onclick="cancelEdit()">Cancel Edit</button>
                        <button type="submit" class="add-btn" id="submitBtn">Add Trade</button>
                    </div>
                </div>
            </form>
        </div>

        <div class="table-container">
            <table>
                <thead><tr><th>Symbol</th><th>Type</th><th>Qty</th><th>Entry</th><th>Exit</th><th>P&L</th><th>Notes</th><th>Action</th></tr></thead>
                <tbody id="tradeTableBody"></tbody>
            </table>
        </div>
    </div>

    <div id="tab-calendar" style="display: none;">
        <div class="calendar-header">
            <button class="month-btn" onclick="changeMonth(-1)">‚Üê Prev</button>
            <h2 id="currentMonthDisplay">Month Year</h2>
            <button class="month-btn" onclick="changeMonth(1)">Next ‚Üí</button>
        </div>
        <div class="calendar-grid" id="calendarGrid">
            </div>
    </div>

    <div id="tab-guide" style="display: none;">
        <div class="guide-box">
            <h2>üìñ Beginner's Guide to Data</h2>
            <p>This journal is private. Your data lives on <b>this browser only</b>. It is not sent to any server. Here is how to keep it safe.</p>
            
            <div class="guide-step">
                <h3>1. How to Backup (Save Data)</h3>
                <p>Since data is only on this device, you should back it up regularly.</p>
                <div class="guide-highlight">
                    Click the <b>üíæ Save</b> button.
                </div>
                <p>This will download a file named <code>trading_journal_backup.json</code> to your computer or phone. Keep this file safe!</p>
            </div>

            <div class="guide-step">
                <h3>2. How to Restore (Load Data)</h3>
                <p>If you switch computers, clear your browser history, or accidentally delete everything, you can get your data back.</p>
                <div class="guide-highlight">
                    Click <b>üìÇ Load</b> and select the <code>.json</code> file you saved earlier.
                </div>
                <p>This will restore all your previous trades instantly.</p>
            </div>

            <div class="guide-step">
                <h3>3. Editing & Deleting</h3>
                <ul>
                    <li><b>‚úèÔ∏è Edit:</b> Click the pencil icon to fix a price or quantity.</li>
                    <li><b>üóëÔ∏è Delete:</b> Click the trash icon to remove a trade.</li>
                </ul>
            </div>

            <div class="warning-box">
                ‚ö†Ô∏è <b>Important Warning:</b><br>
                If you "Clear Browsing Data" or "Clear Cache" in your browser settings, your trades will be deleted. Always download a <b>Backup</b> before clearing your history!
            </div>
        </div>
    </div>
</div>

<script>
    let trades = JSON.parse(localStorage.getItem('tradingJournal')) || [];
    let editId = null;
    let pendingCallback = null;
    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();

    // --- THEME LOGIC ---
    function initTheme() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.setAttribute('data-theme', 'dark');
            document.getElementById('themeToggle').innerText = '‚òÄÔ∏è';
        }
    }
    document.getElementById('themeToggle').addEventListener('click', () => {
        const isDark = document.body.getAttribute('data-theme') === 'dark';
        if (isDark) {
            document.body.removeAttribute('data-theme');
            localStorage.setItem('theme', 'light');
            document.getElementById('themeToggle').innerText = 'üåô';
        } else {
            document.body.setAttribute('data-theme', 'dark');
            localStorage.setItem('theme', 'dark');
            document.getElementById('themeToggle').innerText = '‚òÄÔ∏è';
        }
    });

    // --- INIT ---
    window.onload = function() { 
        initTheme();
        document.getElementById('date').valueAsDate = new Date(); 
        render(); 
        renderCalendar(); 
    };

    // --- NAVIGATION ---
    function switchTab(tabName, btn) {
        document.getElementById('tab-journal').style.display = 'none';
        document.getElementById('tab-calendar').style.display = 'none';
        document.getElementById('tab-guide').style.display = 'none';
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        
        document.getElementById('tab-' + tabName).style.display = 'block';
        btn.classList.add('active');
        
        if(tabName === 'calendar') renderCalendar();
    }

    // --- CORE LOGIC ---
    function handleFormSubmit(e) {
        e.preventDefault();
        const data = {
            date: document.getElementById('date').value,
            symbol: document.getElementById('symbol').value.toUpperCase(),
            type: document.getElementById('type').value,
            entry: parseFloat(document.getElementById('entry').value),
            exit: parseFloat(document.getElementById('exit').value),
            qty: parseInt(document.getElementById('qty').value),
            notes: document.getElementById('notes').value
        };
        data.pnl = (data.type === 'LONG') ? (data.exit - data.entry) * data.qty : (data.entry - data.exit) * data.qty;

        if (editId) {
            const index = trades.findIndex(t => t.id === editId);
            if (index !== -1) trades[index] = { id: editId, ...data };
            showNotification("Trade Updated!", "success");
            editId = null; resetFormUI();
        } else {
            trades.unshift({ id: Date.now(), ...data });
            showNotification("Trade Added!", "success");
        }
        saveAndRender();
        document.getElementById('tradeForm').reset();
        document.getElementById('date').valueAsDate = new Date();
    }

    function editTrade(id) {
        switchTab('journal', document.querySelector('.nav-btn'));
        const t = trades.find(tr => tr.id === id);
        if (!t) return;
        document.getElementById('date').value = t.date;
        document.getElementById('symbol').value = t.symbol;
        document.getElementById('type').value = t.type;
        document.getElementById('entry').value = t.entry;
        document.getElementById('exit').value = t.exit;
        document.getElementById('qty').value = t.qty;
        document.getElementById('notes').value = t.notes || '';
        editId = id;
        const btn = document.getElementById('submitBtn');
        btn.innerText = "Update Trade"; btn.style.backgroundColor = "#f59e0b";
        document.getElementById('cancelEditBtn').style.display = "block";
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function cancelEdit() { editId = null; resetFormUI(); document.getElementById('tradeForm').reset(); document.getElementById('date').valueAsDate = new Date(); }
    function resetFormUI() { document.getElementById('submitBtn').innerText = "Add Trade"; document.getElementById('submitBtn').style.backgroundColor = ""; document.getElementById('cancelEditBtn').style.display = "none"; }
    function triggerDelete(id) { showModal("Delete Trade?", "Are you sure?", () => { trades = trades.filter(t => t.id !== id); saveAndRender(); showNotification("Trade Deleted", "error"); }); }
    function triggerClear() { showModal("Reset All?", "Deletes all data permanently.", () => { trades = []; saveAndRender(); showNotification("All Data Cleared", "error"); }); }
    
    function saveAndRender() { 
        localStorage.setItem('tradingJournal', JSON.stringify(trades)); 
        render(); 
        renderCalendar(); 
    }

    function render() {
        const tbody = document.getElementById('tradeTableBody');
        tbody.innerHTML = '';
        trades.sort((a, b) => new Date(b.date) - new Date(a.date) || b.id - a.id);

        let totalPnL = 0, wins = 0;
        trades.forEach(t => { totalPnL += t.pnl; if(t.pnl > 0) wins++; });
        document.getElementById('totalPnL').innerText = `‚Çπ${totalPnL.toFixed(2)}`;
        document.getElementById('totalPnL').className = totalPnL >= 0 ? 'profit' : 'loss';
        document.getElementById('totalTrades').innerText = trades.length;
        document.getElementById('winRate').innerText = `${trades.length>0?((wins/trades.length)*100).toFixed(1):0}%`;

        // Day-Wise Grouping
        const grouped = trades.reduce((acc, trade) => {
            if (!acc[trade.date]) acc[trade.date] = [];
            acc[trade.date].push(trade);
            return acc;
        }, {});

        Object.keys(grouped).sort((a, b) => new Date(b) - new Date(a)).forEach(date => {
            const dayTrades = grouped[date];
            const dailyPnL = dayTrades.reduce((sum, t) => sum + t.pnl, 0);
            
            tbody.innerHTML += `
                <tr class="date-header">
                    <td colspan="8">
                        <span class="date-title">üìÖ ${new Date(date).toDateString()}</span>
                        <span class="daily-summary ${dailyPnL >= 0 ? 'profit' : 'loss'}">Daily Net: ${dailyPnL >= 0 ? '+' : ''}${dailyPnL.toFixed(2)}</span>
                    </td>
                </tr>
            `;

            dayTrades.forEach(t => {
                tbody.innerHTML += `
                <tr>
                    <td><b>${t.symbol}</b></td>
                    <td><span style="color:${t.type==='LONG'?'blue':'orange'}">${t.type}</span></td>
                    <td>${t.qty}</td><td>${t.entry}</td><td>${t.exit}</td>
                    <td class="${t.pnl>=0?'profit':'loss'}">${t.pnl>=0?'+':''}${t.pnl.toFixed(2)}</td>
                    <td style="font-size:0.85rem;color:var(--text-secondary);">${t.notes||''}</td>
                    <td class="action-cell">
                        <button class="icon-btn" onclick="editTrade(${t.id})" title="Edit">‚úèÔ∏è</button>
                        <button class="icon-btn" onclick="triggerDelete(${t.id})" title="Delete">üóëÔ∏è</button>
                    </td>
                </tr>`;
            });
        });
    }

    // --- CALENDAR RENDER ---
    function renderCalendar() {
        const calendarEl = document.getElementById('calendarGrid');
        calendarEl.innerHTML = '';
        
        const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        document.getElementById('currentMonthDisplay').innerText = `${monthNames[currentMonth]} ${currentYear}`;

        const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        days.forEach(d => calendarEl.innerHTML += `<div class="day-name">${d}</div>`);

        const firstDay = new Date(currentYear, currentMonth, 1).getDay();
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

        for(let i=0; i<firstDay; i++) calendarEl.innerHTML += `<div class="empty-cell"></div>`;

        for(let day=1; day<=daysInMonth; day++) {
            const dateStr = `${currentYear}-${String(currentMonth+1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const dayPnL = trades.filter(t => t.date === dateStr).reduce((sum, t) => sum + t.pnl, 0);
            
            let pnlHtml = '';
            if(dayPnL !== 0) {
                pnlHtml = `<div class="cal-pnl ${dayPnL >= 0 ? 'profit' : 'loss'}">${dayPnL >= 0 ? '+' : ''}${dayPnL.toFixed(0)}</div>`;
            }

            const isToday = new Date().toDateString() === new Date(currentYear, currentMonth, day).toDateString();
            
            calendarEl.innerHTML += `
                <div class="calendar-cell ${isToday ? 'today-cell' : ''}">
                    <span class="date-num">${day}</span>
                    ${pnlHtml}
                </div>
            `;
        }
    }

    function changeMonth(step) {
        currentMonth += step;
        if(currentMonth > 11) { currentMonth = 0; currentYear++; }
        if(currentMonth < 0) { currentMonth = 11; currentYear--; }
        renderCalendar();
    }

    // --- HELPERS ---
    function downloadJSON() { const a = document.createElement('a'); a.href = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(trades)); a.download = "trading_journal_backup.json"; document.body.appendChild(a); a.click(); a.remove(); showNotification("File Downloaded!", "success"); }
    function loadJSON(input) { const f = input.files[0]; if(!f) return; showModal("Overwrite Data?", "This replaces current trades.", () => { const r = new FileReader(); r.onload = e => { try { trades = JSON.parse(e.target.result); saveAndRender(); showNotification("Loaded!", "success"); } catch(err) { showNotification("Invalid File", "error"); } }; r.readAsText(f); }); input.value = ''; }
    function showModal(title, msg, cb) { document.getElementById('modalTitle').innerText = title; document.getElementById('modalMessage').innerText = msg; pendingCallback = cb; document.getElementById('confirmModal').classList.add('open'); }
    function closeModal() { document.getElementById('confirmModal').classList.remove('open'); pendingCallback = null; }
    document.getElementById('confirmActionBtn').addEventListener('click', () => { if(pendingCallback) pendingCallback(); closeModal(); });
    function showNotification(msg, type) { const n = document.getElementById('notification'); n.innerText = msg; n.className = 'show ' + type; setTimeout(() => n.className = '', 3000); }
</script>
</body>
</html>
